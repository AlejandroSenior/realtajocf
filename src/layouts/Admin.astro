---
import Layout from '@/layouts/Layout.astro';
import NavBar from '@/components/admin/NavBar.astro';
import SideBar from '@/components/admin/SideBar.astro';
---

<Layout title="Admin - Real Tajo C.F.">
  <div id="loading-screen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p>Verificando acceso...</p>
    </div>
  </div>

  <div id="admin-content" class="flex h-screen bg-gray-100">
    <SideBar />

    <div class="flex-1 flex flex-col overflow-hidden">
      <NavBar />

      <main class="flex-1 overflow-y-auto bg-gray-50 p-6">
        <slot />
      </main>
    </div>
  </div>
</Layout>

<script>
  import { getCurrentUser } from '@/firebase/client';

  document.addEventListener('DOMContentLoaded', async () => {
    const loadingScreen = document.getElementById('loading-screen');
    const adminContent = document.getElementById('admin-content');

    if (!loadingScreen || !adminContent) {
      console.error('Elementos de UI no encontrados');
      window.location.href = '/login';
      return;
    }

    try {
      // Verificar si el usuario est치 autenticado
      const user = await getCurrentUser();

      if (user) {
        // El usuario est치 autenticado, mostrar el contenido de admin
        loadingScreen.style.display = 'none';
        adminContent.style.display = 'flex';
      } else {
        // El usuario no est치 autenticado, redirigir al login
        window.location.href = '/login';
      }
    } catch (error) {
      console.error('Error verificando autenticaci칩n:', error);
      // En caso de error, redirigir al login por seguridad
      window.location.href = '/login';
    }
  });
</script>

<style>
  .loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .loading-content {
    text-align: center;
    color: white;
  }

  .loading-logo {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-bottom: 20px;
    object-fit: cover;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  .loading-content p {
    margin: 0;
    font-size: 16px;
    opacity: 0.9;
  }
</style>
